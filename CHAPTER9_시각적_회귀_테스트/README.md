# 시각적 회귀 테스트

### 목차

- [시각적 회귀 테스트의 필요성](#시각적-회귀-테스트의-필요성)
- [시각적 회귀 테스트를 활용한 적극적 리팩터링](#시각적-회귀-테스트를-활용한-적극적-리팩터링)

<br />

## 시각적 회귀 테스트의 필요성

- 스타일 변경 검증의 어려움
  - 현실적으로 모든 페이지를 육안으로 확인하는 것은 불가능하다.
  - 많은 화면이 수많은 공통 컴포넌트를 공유하기 때문에 한 컴포넌트의 수정 여파가 크다
- 시각적 회귀 테스트를 스냅숏 테스트로 대체할 수 있을까
  - 5장에서 다룬 스냅숏 테스트는 시각적 회귀 테스트의 한 방법으로, 클래스 속성의 변경으로 스타일이 변경되는 것을 알 수 있다
  - 하지만 스냅숏 테스트만으로는 전역에 정의된 스타일 영향은 알기 힘들다.
  - 게다가 `CSS Modules`을 사용하면 스냅숏 테스트에서는 CSS로 정의한 내용을 알지 못한다.

### 시각적 회귀 테스트의 선택지

가장 신뢰도 높은 방법은 실제 브라우저에서 렌더링된 화면을 비교하는 것이다. 테스트할 화면을 브라우저에 렌더링하고 특정 시점에 캡처한 이미지들을 픽셀 단위로 비교할 수도 있다.

- 시각적 회귀 테스트는 크로미엄 같은 브라우저를 헤드리스 모드로 실행한 상태에서 실시한다.
- 일반적으로 헤드리스 브라우저는 E2E 테스트 프레임워크에 포함됐으며, 대부분 E2E 테스트 프레임워크는 공식적으로 시각적 회귀 테스트를 지원한다.
- 프레임워크가 지원하는 시각적 회귀 테스트에서도 페이지 단위로 캡처한 화면을 비교한다. 프레임워크는 헤드리스 브라우저에 화면을 요청하고 화면이 이동하면 화면을 캡처한다.

## 시각적 회귀 테스트를 활용한 적극적 리팩터링

회귀 테스트는 릴리스 전에 실시한다고 생각하지만, 반복 작업을 줄이고 싶다면 개발 과정에도 도입하는 것이 좋다.

### 반응형 디자인에 활용하기

프로젝트 사정상 PC용 디자인을 먼저 완성하고 이후 모바일용 디자인을 구현해도 시각적 회귀 테스트가 설정됐다면 실수를 줄일 수 있다.

### 릴리스 직전의 리팩터링에 활용하기

시각적 회귀 테스트를 도입하면 레거시 코드를 리팩터링 할 때 도움이 된다.

예를 들어, 사용처가 불분명한 전역 CSS 코드가 있을 경우에도 마음 놓고 리팩터링을 할 수 있다. 전역 코드를 하나씩 삭제하면서 시각적 회귀 테스트를 통해 프로젝트에 미치는 영향을 확인할 수 있다.

### 스토리 커밋 습관화로 시작하는 시각적 회귀 테스트

스토리를 UI 컴포넌트 단위로 시각적 회귀 테스트를 실시하는 것이 쉽다. 스토리가 필요할 때만 등록할 수 있지만, 등록된 스토리의 숫자만큼 세밀한 검증이 가능하기 때문에 습관전으로 스토리를 커밋할 것을 권한다.

또한, 릴리스 직전에 스토리를 커밋하면 반응형 디자인이 필요할 때 여유롭게 대응하는 것이 힘들어 도입 자체가 좌절되기 쉽다. 스토리가 정말로 필요하지 않다고 느껴지지 않는 한, 처음부터 커밋하자.
