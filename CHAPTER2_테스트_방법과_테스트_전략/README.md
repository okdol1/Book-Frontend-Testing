# CHAPTER 2 테스트 방법과 테스트 전략

### 목차

- [프런트엔드 테스트의 범위](#프런트엔드-테스트의-범위)
- [프런트엔드 테스트의 목적](#프런트엔드-테스트의-목적)
- [테스트 전략 모델](#테스트-전략-모델)

<br />

## 프런트엔드 테스트의 범위

테스트의 범위와 목적을 이해하고, 상황에 맞는 테스트를 작성해야 한다.

> 정적 분석

타입스크립트나 ESLint를 활용해 모듈 내부, 인접 모듈을 연계해 사용할 때의 문제점을 검증한다.

- 타입스크립트
  - 타입스크립트를 활용하는 정적 분석은 버그를 조기에 발견할 수 있도록 한다.
  - 특히 타입 추론은 런타임 작동을 예측하여, 함수의 반환값이 생각한 타입과 일치하는지 검증할 때도 도움이 된다.
- ESLint
  - 코드 가이드라인을 제공하는 ESLint도 정적 분석 도구 중 하나다.
  - ESLint는 부적절한 구문을 수정해서 잠재적으로 발생할 수 있는 버그를 사전에 방지한다.

> 단위 테스트

가장 기초적인 테스트로, 한 가지 모듈에 한정하여 해당 모듈이 제공하는 기능을 검증한다.

독립된 환경에서 검증하기 때문에 실제로 애플리케이션을 사용할 때는 거의 발생하지 않는 케이스(corner case) 검증에 적합하다.

- 테스트할 모듈이 특정 입력값을 받아 기대하는 출력값을 반환하는지 테스트한다.

  - SPA 개발에서 UI 컴포넌트는 테스트하기 쉽다. UI 컴포넌트는 입력값(`Props`)에 알맞은 출력값(HTML 블록)을 반환하기 때문에 일반적인 함수와 같은 방법으로 테스트할 수 있기 때문이다.

- 단위테스트는 모듈에 따라 거의 발생하지 않는 케이스(corner case) 검증에 적합하다.
  - '이런 상황은 일어날 수 없을까? 일어날 수 있다면 어떻게 처리해야 하는가'와 같은 거듭된 검토 과정에서 미처 고려하지 못했던 부분을 발견할 수 있다.

> 통합 테스트

통합 테스트는 여러 모듈을 연동한 기능을 테스트한다. 기능은 주로 인터랙션에서 시작된다.

다음과 같은 목록 화면이 있는 웹을 떠올려보자.

1. 셀렉트 박스를 조작한다
2. URL 검색 쿼리가 변경된다.
3. 검색 쿼리가 변경되어 데이터 취득 API가 호출된다.
4. 목록 화면 내용을 갱신한다.

셀렉트 박스를 조작하는 인터랙션을 시작으로 최종적으로 목록 화면 내용을 갱신하는 처리가 이뤄진다.

'`1`을 실행하면 `4`도 실행된다' 같은 테스트가 통합 테스트다.

- `1`~`4`까지 실행되는 넓은 범위의 통합 테스트다.
- `1`과 `2`만 실행되는 것처럼 좁은 범위의 테스트가 효율적일 때도 있다.
  - 예를 들어 코너 케이스 테스트 때문에 테스트가 복잡해지면 범위를 좁혀서 통합 테스트를 실시해야 테스트 목적이 명확해진다.

> E2E 테스트

UI 테스트뿐만 아니라 외부 스토리지와 같이 연동 중인 하위 시스템을 포함하는 테스트다. UI는 물론 연동된 외부 기능이 정상적으로 작동하는지 검증할 수 있다.

- 헤드리스 브라우저와 UI 자동화 도구를 결합하여 검증한다.
- 가장 광범위한 통합 테스트로, 실제 애플리케이션을 사용할 때와 가장 유사한 테스트이기도 하다.

## 프런트엔드 테스트의 목적

> 기능 테스트(인터랙션 테스트)

- 개발된 기능에 문제가 없는지 검증하는 테스트다.
- 웹 프런트엔드의 대부분 기능은 UI 인터랙션에서 시작되기 때문에 인터랙션 테스트가 기능 테스트가 될 때가 많으며, 중요성 또한 높다.

리액트 같은 라이브러리로 구현된 UI 컴포넌트에는 브라우저 없이도 테스트할 수 있는 가상 브라우저 환경이 있다.

[실제 브라우저가 없어도 가능한 인터랙션 테스트 실제 사례]

- 버튼을 클릭하면 콜백 함수가 호출된다.
- 문자를 입력하면 전송 버튼이 활성화된다.
- 로그아웃 버튼을 클릭하면 로그인 화면으로 이동된다.

그런데 가상 브라우저만으로 스크롤이나 세션 스토리지 같은 기능은 테스트할 수 없다. 이처럼 실제 브라우저 API를 사용하는 것이 중요한 테스트라면 헤드리스 브라우저와 UI 자동화 도구를 사용한다.

[실제 브라우저가 필요한 인터랙션 테스트 실제 사례]

- 맨 아래까지 스크롤을 내리면 추가 데이터를 가져온다.
- 세션 스토리지에 저장되 값을 불러온다.

> 비기능 테스트(접근성 테스트)

접근성 테스트는 비기능 테스트의 한 종류다.

- 신체적, 정신적 특성에 따른 차이 없이 동등하게 제품을 사용할 수 있는지 검증하는 테스트다.
- 최근에는 웹 접근성 관련 API가 여러 플랫폼에 추가돼 테스트 자동화를 할 때 객관적으로 검증할 수 있는 환경이 갖춰지고 있다.

> 시각적 회귀 테스트

회귀 테스트 중 하나인 시각적 회귀 테스트에서는 특정 시점을 기준으로 전후 차이를 비교하여 문제가 있는지 검증하는 테스트다.

- 헤드리스 브라우저에 그려진 내용을 캡처하여 캡처된 이미지 간 차이 검증한다.
- 초기 렌더링된 상태만 비교하는 것에 그치지 않고 사용자 조작으로 변경된 화면까지 캡처하여 비교한다.
- 웹 프런트엔드는 시각적으로 보이는 UI 컴포넌트를 개발하기 때문에 시각적 회귀 테스트가 중요하다.

## 테스트 전략 모델

테스트 방법을 아래 계층으로 분류할 수 있다. 위로 갈수록 실제 제품과 유사한 테스트가 가능하다. 그러나 상층부 테스트는 많은 시간과 비용이 필요하다. 테스트용 데이터베이스 서버를 준비하는 등 실제 환경과 최대한 유사한 환경을 구축해야 하고, 테스트할 때마다 제품과 연동된 외부 시스템의 응답도 기다려야 한다.

<img src="./assets/테스트%20전략%20모델.png" alt="E2E 테스트 - 통합 테스트 - 단위 테스트" />

- Bottom to Top -> 고가

  - 높은 유사성
  - 긴 실행 시간
  - 낮은 안정성

- Top to Bottom -> 고속
  - 낮은 유사성
  - 짧은 실행 시간
  - 높은 안정성

> 아이스크림 콘 전략

상층부 테스트의 비중이 높은 아이스크림 콘은 안티패턴으로 자주 언급되는 테스트 전략 모델이다. 운용 비용이 높을 뿐만 아니라 외부 모듈의 의존성 때문에 아주 가끔씩 실패하는 불안정한 테스트가 비교적 많다.

> 테스트 피라미드

하층부 테스트의 비중이 높을수록 더욱 안정적이고 가성비 높은 테스트가 가능하다는 것이 테스트 피라미드의 핵심이다.

> 테스팅 트로피

이 모델의 핵심은 통합 테스트 비중이 가장 높아야 한다는 것이다.

프런트엔드 기능은 사용자 조작(인터랙션)에서 시작한다. 인터랙션 기점으로 한 통합 테스트 비중이 높을수록 더욱 우수한 테스트 전략이라는 의도가 있다.

테스팅 라이브러리와 제스트를 사용하면 헤드리스 브라우저 없이도 사용자 조작을 재현해 테스트할 수 있어서 실행 속도가 빠르면서도 실제 제품과 유사한 테스트가 가능하다.
